#user  nobody;
worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       8080;
        server_name  localhost;
        
        # 根目录设置-这里替换为自己电脑上路径下的地址
        root D:/wenjian/personal-pro/ai-code/tmp/code_deploy;
        
        # 默认首页文件
        index index.html index.htm;

        # 优先处理部署目录（这个要放在最前面）
        location ~ ^/([a-zA-Z0-9_-]+)/? {
            # 调试信息：在响应头显示匹配的路径
            add_header X-Deploy-Key $1;
            add_header X-Try-Files "$uri, $uri/, /$1/index.html, /$1/index.htm";
            
            # 尝试查找文件
            try_files $uri $uri/ /$1/index.html /$1/index.htm =404;
        }

        # 处理静态资源（排除HTML文件）
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|json)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
            try_files $uri =404;
        }

        # 处理根路径 - 返回友好提示
        location = / {
            add_header Content-Type text/html;
            return 200 '<html><body><h1>AI Code Deploy Service</h1><p>Please access with specific deploy path, e.g., http://localhost:8080/your-deploy-key/</p></body></html>';
        }

        # 移除404错误页面配置，使用默认404页面
        # 或者创建简单的404页面
    }
}